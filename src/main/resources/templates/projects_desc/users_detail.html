<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="layout/header :: header(title = #{projects_desc.users.caption})"></head>

<body class="theme-dark"> <!-- right-to-left -->
<span th:replace="fragments/layout_v1.html :: top">top</span>
    <div class="card flex-fill w-100">
        <div class="card-header">
            <h5 class="card-title mb-0" th:text="#{projects_desc.users.caption}"></h5>
        </div>
        <div class="card-body">
            <div>
                <!--/*@thymesVar id="projects_desc_users_detail" type="java.util.List"*/-->
                <form id="projects-desc-users-updater-form" data-toggle="validator" method="post" class="was-validated" th:action="@{/projects_desc/users_model}">
                    <!--/*@thymesVar id="mode" type="java.lang.Long"*/-->
                    <input type="hidden" id="mode" name="mode" th:value="${mode}">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-outline-dark mr-1" th:text="#{general.back}" form="projects-desc-users-indexfrm">Cancel</button>
                        <div th:switch="${mode}">
                            <button th:case="0" type="submit" id="projects-desc-users-addbtn" class="btn btn-outline-success" th:text="#{general.addbtn}">Add</button>
                            <button th:case="1" type="submit" id="projects-desc-users-editbtn" class="btn btn-outline-success" th:text="#{general.editbtn}">Edit</button>
                            <button th:case="2" type="submit" id="projects-desc-users-delbtn" class="btn btn-outline-success" th:text="#{general.delbtn}">Delete</button>
                        </div>
                    </div>
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="prrl_id" th:value="${prrl_id}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="pr_id" th:value="${parent_pr_id}" >

                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_users_table_order_column" th:value="${projects_desc_users_table_order_column}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_users_table_order_type" th:value="${projects_desc_users_table_order_type}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_users_table_search" th:value="${projects_desc_users_table_search}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_users_table_pagelen" th:value="${projects_desc_users_table_pagelen}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_users_table_page" th:value="${projects_desc_users_table_page}" >

                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_main_table_order_column" th:value="${projects_desc_main_table_order_column}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_main_table_order_type" th:value="${projects_desc_main_table_order_type}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_main_table_search" th:value="${projects_desc_main_table_search}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_main_table_pagelen" th:value="${projects_desc_main_table_pagelen}" >
                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_main_table_page" th:value="${projects_desc_main_table_page}" >

                    <!--suppress ThymeleafVariablesResolveInspection -->
                    <input type="hidden" name="projects_desc_tab" th:value="${projects_desc_tab}" >

                    <div class="form-row">
                        <div class="col-md-1 mb-1" id="parent_pr_id_row">
                            <label for="parent_pr_id" class="form-label" th:text="'1. '+ #{projects_desc.users.parent_pr_id}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <input type="number" class="form-control" id="parent_pr_id" name="parent_pr_id" th:value="${parent_pr_id}">
                            <div class="valid-feedback" th:text="#{general.field_fill}"> Looks good! </div>
                            <div class="invalid-feedback" th:text="#{general.filed_unfilled}"> Bad! </div>
                        </div>

                        <div class="col-md-4 mb-1" id="parent_pr_name_row">
                            <label for="parent_pr_name" class="form-label" th:text="'2. '+ #{projects_desc.users.parent_pr_name}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <input type="text" maxlength="64" class="form-control" id="parent_pr_name" name="parent_pr_name" th:value="${parent_pr_name}">
                            <div class="valid-feedback" th:text="#{general.field_fill}"> Looks good! </div>
                            <div class="invalid-feedback" th:text="#{general.filed_unfilled}"> Bad! </div>
                        </div>
                    </div><!-- Row 1 -->

                    <div class="form-row">
                        <div class="col-md-1 mb-1" id="prrl_id_row">
                            <label for="prrl_id" class="form-label" th:text="'3. '+ #{projects_desc.users.prrl_id}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <input type="number" class="form-control" id="prrl_id" name="prrl_id" th:value="${prrl_id}">
                            <div class="valid-feedback" th:text="#{general.field_fill}"> Looks good! </div>
                            <div class="invalid-feedback" th:text="#{general.filed_unfilled}"> Bad! </div>
                        </div>
                    </div><!-- Row 2 -->

                    <div class="form-row">
                        <div class="col-md-1 mb-1" id="employee_id_row">
                            <label class="form-label" for="employee_id" th:text="'4. '+ #{projects_desc.users.employee_id}"></label>
                            <div class="custom-control custom-switch centered">
                                <div class="custom-control custom-switch">
                                    <!--suppress ThymeleafVariablesResolveInspection -->
                                    <input class="custom-control-input" type="checkbox" id="employee_id" name="employee_id" th:checked="${employee_id == 1}">
                                    <label class="custom-control-label" for="employee_id"></label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 mb-1">
                            <label for="user_id" class="form-label" th:text="'5. '+#{projects_desc.users.user_id}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <select type="text" id="user_id" name="user_id" class="form-control p-1" aria-describedby="user_id_helpBlock" th:value="${user_id}">
                                <!--suppress ThymeleafVariablesResolveInspection -->
                                <option class="p-1"
                                        th:each="users : ${users_list}"
                                        th:value="${users.id}"
                                        th:text="${users.user_surname}"
                                        th:selected="${users.id == user_id}"
                                ></option>
                            </select>
                        </div>
                    </div><!-- Row 3 -->

                    <div class="form-row">
                        <div class="col-md-1 mb-1" id="partner_id_row">
                            <label class="form-label" for="partner_id" th:text="'6. '+ #{projects_desc.users.partner_id}"></label>
                            <div class="custom-control custom-switch centered">
                                <div class="custom-control custom-switch">
                                    <!--suppress ThymeleafVariablesResolveInspection -->
                                    <input class="custom-control-input" type="checkbox" id="partner_id" name="partner_id" th:checked="${partner_id == 1}">
                                    <label class="custom-control-label" for="partner_id"></label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-5 mb-1" id="cnt_id_div">
                            <label for="cnt_id" th:text="'7. '+#{projects_desc.users.cnt_id}"></label>
                            <div class="input-group d-flex">
                                <!--suppress ThymeleafVariablesResolveInspection -->
                                <select type="text" id="cnt_id" name="cnt_id" class="form-control p-1" aria-describedby="cnt_id_helpBlock" th:value="${cnt_id}">
                                    <option value=""></option>
                                    <!--suppress ThymeleafVariablesResolveInspection -->
                                    <option class="p-1"
                                            th:each="cnt : ${cnt_list}"
                                            th:value="${cnt.cnt_id}"
                                            th:text="${cnt.cnt_name}"
                                            th:selected="${cnt.cnt_id == cnt_id}">
                                    </option>
                                </select>
                                <div class="valid-feedback" th:text="#{general.field_fill}"> Looks good! </div>
                                <div class="invalid-feedback" th:text="#{general.filed_unfilled}"> Bad! </div>
                                <span class="input-group-append">
                                    <button type="button" class="btn btn-outline-success" id="cnt_id_show" name="cnt_id_show"><i class="fas fa-clipboard-list"></i></button>
                                </span>
                            </div>
                        </div>

                        <div class="col-md-2 mb-1">
                            <label for="cc_id" class="form-label" th:text="'8. '+#{projects_desc.users.cc_id}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <select type="text" id="cc_id" name="cc_id" class="form-control p-1" aria-describedby="user_id_helpBlock" th:value="${cc_id}">
                                <!--suppress ThymeleafVariablesResolveInspection -->
                                <option class="p-1"
                                        th:each="contacts : ${contacts_list}"
                                        th:value="${contacts.cc_id}"
                                        th:text="${contacts.cc_name}"
                                        th:selected="${contacts.cc_id == cc_id}"
                                ></option>
                            </select>
                        </div>
                    </div><!-- Row 4 -->

                    <div class="form-row">
                        <div class="col-md-2 mb-1" id="pr_role_id_row">
                            <label for="pr_role_id" class="form-label" th:text="'9. '+#{projects_desc.users.pr_role_id}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <select type="text" id="pr_role_id" name="pr_role_id" class="form-control p-1" aria-describedby="user_id_helpBlock" th:value="${pr_role_id}">
                                <!--suppress ThymeleafVariablesResolveInspection -->
                                <option class="p-1"
                                        th:each="pr_role : ${pr_role_list}"
                                        th:value="${pr_role.pr_role_id}"
                                        th:text="${pr_role.pr_role_name}"
                                        th:selected="${pr_role.pr_role_id == pr_role_id}"
                                ></option>
                            </select>
                        </div>
                    </div><!-- Row 5 -->

                    <div class="form-row">
                        <div class="col-md-9 mb-1" id="prrl_description_row">
                            <label for="prrl_description" th:text="'10. '+#{projects_desc.users.prrl_description}"></label>
                            <!--suppress ThymeleafVariablesResolveInspection -->
                            <textarea class="form-control" rows="3" maxlength="512" style="resize:none;" id="prrl_description" name="prrl_description" th:text="${prrl_description}">
                            </textarea>
                            <div class="valid-feedback" th:text="#{general.field_fill}"> Looks good! </div>
                            <div class="invalid-feedback" th:text="#{general.filed_unfilled}"> Bad! </div>
                        </div>
                    </div><!-- Row 6 -->
                </form>
            </div>
        </div>
    </div>

    <!--/*@thymesVar id="projects_desc_users_detail" type="java.util.List"*/-->
    <form id="projects-desc-users-indexfrm" method="post" th:action="@{/projects_desc}" hidden>
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="prrl_id" th:value="${prrl_id}">
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="pr_id" th:value="${parent_pr_id}">

        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_users_table_order_column" th:value="${projects_desc_users_table_order_column}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_users_table_order_type" th:value="${projects_desc_users_table_order_type}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_users_table_search" th:value="${projects_desc_users_table_search}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_users_table_pagelen" th:value="${projects_desc_users_table_pagelen}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_users_table_page" th:value="${projects_desc_users_table_page}" >

        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_main_table_order_column" th:value="${projects_desc_main_table_order_column}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_main_table_order_type" th:value="${projects_desc_main_table_order_type}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_main_table_search" th:value="${projects_desc_main_table_search}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_main_table_pagelen" th:value="${projects_desc_main_table_pagelen}" >
        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_main_table_page" th:value="${projects_desc_main_table_page}" >

        <!--suppress ThymeleafVariablesResolveInspection -->
        <input name="projects_desc_tab" th:value="${projects_desc_tab}" >
    </form>

<span th:replace="fragments/layout_v1.html :: bottom">bottom</span>

<span th:replace="fragments/error :: errorscript_frm(formname = 'projects-desc-users-indexfrm')">Error</span>

<script>
    $(document).ready(function(){
        $('#main_li').removeClass('active');

        $('#projects_li').addClass('active').removeClass('collapsed');
        $('#projects_a').attr('aria-expanded',true);
        $('#projects').addClass('show');

        $('#projects_desc_a').addClass('text-success');
<!-- Hihglight menu -->
        $('#parent_pr_id').prop('readOnly',true);
        $('#parent_pr_name').prop('readOnly',true);

        if($('#mode').val() === '0'){
            $('#prrl_id_row').prop('hidden',true);

            $('#cnt_id').attr('disabled', 'disabled');
            $('#cnt_id_show').prop('disabled',true).removeClass('btn-outline-success').addClass('btn-outline-dark');
            $('#cc_id').attr('disabled', 'disabled');
        }
        else if($('#mode').val() === '1'){
            $('#prrl_id_row').prop('hidden',true);

        }
        else if($('#mode').val() === '2' || $('#mode').val() === '4'){
            $('#prrl_id').prop('readOnly',true);

            $('#employee_id').attr('disabled', 'disabled');
            $('#user_id').attr('disabled', 'disabled');

            $('#partner_id').attr('disabled', 'disabled');
            $('#cnt_id').attr('disabled', 'disabled');
            $('#cnt_id_show').prop('disabled',true).removeClass('btn-outline-success').addClass('btn-outline-dark');
            $('#cc_id').attr('disabled', 'disabled');

            $('#pr_role_id').attr('disabled', 'disabled');
            $('#prrl_description').prop('readOnly', true);
        }

<!-- Form Start -->
        $('#cnt_id')
            .wrap("<div class=\"position-relative\"></div>")
            .select2({
                id: '-1', // the value of the option
                placeholder: /*[[#{requests.list.client_placeholder}]]*/ "Select a client",
                allowClear: true,
                minimumInputLength: 2,
                width: 'element',
                dropdownAutoWidth: true
            });

        $('#cnt_id_show').on('click', function () {
            if($('#cnt_id_show').hasClass('btn-outline-success')) {
                $('#cnt_id_show').removeClass('btn-outline-success').addClass('btn-success');
                var options_zero = {
                    id: '-1', // the value of the option
                    placeholder: /*[[#{requests.list.client_placeholder}]]*/ "Select a client",
                    allowClear: true,
                    width: 'element',
                    dropdownAutoWidth: true
                };
                $("#cnt_id").select2("destroy").select2(options_zero);
            }
            else if($('#cnt_id_show').hasClass('btn-success')){
                $('#cnt_id_show').addClass('btn-outline-success').removeClass('btn-success');
                var options_two = {
                    id: '-1', // the value of the option
                    placeholder: /*[[#{requests.list.client_placeholder}]]*/ "Select a client",
                    allowClear: true,
                    minimumInputLength: 2,
                    width: 'element',
                    dropdownAutoWidth: true
                };
                $("#cnt_id").select2("destroy").select2(options_two);
            }
        });

        $('#user_id')
            .wrap("<div class=\"position-relative\"></div>")
            .select2({
                placeholder: /*[[#{report_client_balance.client_placeholder}]]*/ "Select a user",
                allowClear: true
            });

        $('#prrl_id').prop('readOnly',true);
        $('#act_type_sname').prop('required',true);

        function contactsChange() {
            $('#cc_id').empty();
            $.ajax({
                url:/*[[@{'/projects_desc/get_contacts'}]]*/ "/projects_desc/get_contacts",
                type: "get",
                data: {
                    "cnt_id": $('#cnt_id').val(),
                    "parent_pr_id": $('#parent_pr_id').val(),
                    "prrl_id": $('#prrl_id').val(),
                    "mode_id": $('#mode').val()
                },
                success: function (contacts_detail) {
                    for (var i = 0; i < contacts_detail.data.length; i++) {
                        if(i === 0) {
                            $("select[name='cc_id']").find('option').end().append("<option value=''></option>");
                        }
                        $("select[name='cc_id']").find('option').end().append("<option value='" + contacts_detail.data[i].cc_id + "'>" + contacts_detail.data[i].cc_name + "</option>");
                    }
                }
            });
        }

        $('#cnt_id').change(function () {
            contactsChange();
        });

        $('#employee_id').click(function() {
            if ($('#employee_id').is(':checked')) {
                $('#user_id').removeAttr('disabled');

                $('#partner_id').removeAttr('checked');
                $('#cnt_id').attr('disabled', 'disabled');
                $('#cnt_id_show').prop('disabled',true).removeClass('btn-outline-success').addClass('btn-outline-dark');
                $('#cc_id').attr('disabled', 'disabled');
            }
            else{
                $('#employee_id').removeAttr('checked');
                $('#user_id').attr('disabled', 'disabled');

                $('#partner_id').attr('checked',true);
                $('#cnt_id').removeAttr('disabled');
                $('#cnt_id_show').prop('disabled',false).addClass('btn-outline-success').removeClass('btn-outline-dark');
                $('#cc_id').removeAttr('disabled');
            }
        });

        $('#partner_id').click(function() {
            if ($('#partner_id').is(':checked')) {
                $('#employee_id').removeAttr('checked');
                $('#user_id').attr('disabled', 'disabled');

                $('#cnt_id').removeAttr('disabled');
                $('#cnt_id_show').prop('disabled',false).addClass('btn-outline-success').removeClass('btn-outline-dark');
                $('#cc_id').removeAttr('disabled');
            }
            else{
                $('#employee_id').attr('checked', true);
                $('#user_id').removeAttr('readOnly');

                $('#partner_id').removeAttr('checked');
                $('#cnt_id').attr('disabled', 'disabled');
                $('#cnt_id_show').prop('disabled',true).removeClass('btn-outline-success').addClass('btn-outline-dark');
                $('#cc_id').attr('disabled', 'disabled');
            }
        });
<!-- Change Function -->
    });
</script>
</body>
</html>