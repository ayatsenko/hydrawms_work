<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.thymeleaf.org ">
<body>
<span th:fragment="report_dk_doc_body" th:remove="tag">
    <div id="table-report-dk-doc-buttons">
               <button type="button" id="table-report-dk-doc-comment" class="btn btn-dark mr-2" disabled><i class="fas fa-comment-alt"></i></button>
    </div>
    <div><table id="table-report-dk-doc" class="table table-striped table-sm table-bordered" cellspacing="0" style="width:100%;"></table></div>
</span>

<script th:fragment="cardscript" th:inline="javascript">
    var dkmdd_id_width, order_name_width, bill_date_width,paid_date_width,day_count_width, currency_id_width, currency_name_width, doc_prepaying_currency_sum_width,
        doc_prepaying_sum_width, doc_expired_currency_sum_width, doc_expired_sum_width, doc_trouble_currency_sum_width, doc_troubl_sum_width,
        doc_all_currency_sum_width, doc_all_sum_width, comment_id_width;

    var dkmdd_id_class, order_name_class, bill_date_class,paid_date_class,day_count_class, currency_id_class, currency_name_class, doc_prepaying_currency_sum_class,
        doc_prepaying_sum_class, doc_expired_currency_sum_class, doc_expired_sum_class, doc_trouble_currency_sum_class, doc_troubl_sum_class,
        doc_all_currency_sum_class, doc_all_sum_class, comment_id_class;

    if(mobileScreenSize){
        vDomParam = "Blfrtp";

        dkmdd_id_width = "";
        dkmdd_id_class = "none";
        order_name_width = "";
        order_name_class = "none";
        bill_date_width = "40%";
        bill_date_class = "all md_size md_head_size md_footer_size text-center order_name";
       paid_date_width = "15%";
       paid_date_class = "min-tablet-p md_size md_head_size md_footer_size text-center";
       day_count_width = "15%";
       day_count_class = "md_size md_head_size md_footer_size cell-light-grey head-light-grey text-center";
        currency_id_width = "15%";
        currency_id_class = "min-tablet-p md_size md_head_size md_footer_size text-center";
        currency_name_width = "";
        currency_name_class = "none noExport";
        comment_id_width = "";
        comment_id_class = "none noExport";
    }
    else if(smallScreenSize){
        vDomParam = "Blfrtip";

        dkmdd_id_width = "";
        dkmdd_id_class = "none";
        order_name_width = "17%";
        order_name_class = "small_size small_head_size small_footer_size";
        currency_id_width = "";
        currency_id_class = "none";
        currency_name_width = "5%";
        currency_name_class = "small_size small_head_size small_footer_size text-center";
        bill_date_width = "6%";
        bill_date_class = "small_size small_head_size small_footer_size text-center";
        paid_date_width = "6%";
        paid_date_class = "small_size small_head_size small_footer_size text-center";
        day_count_width = "7%";
        day_count_class = "small_size small_head_size small_footer_size text-center";
        doc_prepaying_currency_sum_width = "7%";
        doc_prepaying_currency_sum_class = "small_size small_head_size small_footer_size cell-light-grey head-light-grey text-center";
        doc_prepaying_sum_width = "7%";
        doc_prepaying_sum_class = "small_size small_head_size small_footer_size cell-light-grey head-light-grey text-center";
        doc_expired_currency_sum_width = "7%";
        doc_expired_currency_sum_class = "small_size small_head_size small_footer_size text-center";
        doc_expired_sum_width = "7%";
        doc_expired_sum_class = "small_size small_head_size small_footer_size text-center";
        doc_trouble_currency_sum_width = "7%";
        doc_trouble_currency_sum_class = "small_size small_head_size small_footer_size cell-light-grey head-light-grey text-center";
        doc_troubl_sum_width = "7%";
        doc_troubl_sum_class = "small_size small_head_size small_footer_size cell-light-grey head-light-grey text-center";
        doc_all_currency_sum_width = "7%";
        doc_all_currency_sum_class = "small_size small_head_size small_footer_size text-center";
        doc_all_sum_width = "7%";
        doc_all_sum_class = "small_size small_head_size small_footer_size text-center";
        comment_id_width = "3%";
        comment_id_class = "small_size small_head_size small_footer_size text-center";
    }
    else{
        vDomParam = "Blfrtip";

        dkmdd_id_width = "";
        dkmdd_id_class = "none";
        order_name_width = "20%";
        order_name_class = "md_size md_head_size md_footer_size";
        currency_id_width = "";
        currency_id_class = "none";
        currency_name_width = "5%";
        currency_name_class = "md_size md_head_size md_footer_size text-center";
        bill_date_width = "6%";
        bill_date_class = "md_size md_head_size md_footer_size text-center";
        paid_date_width = "6%";
        paid_date_class = "md_size md_head_size md_footer_size text-center";
        day_count_width = "4%";
        day_count_class = "md_size md_head_size md_footer_size text-center";
        doc_prepaying_currency_sum_width = "7%";
        doc_prepaying_currency_sum_class = "md_size md_head_size md_footer_size cell-light-grey head-light-grey text-center";
        doc_prepaying_sum_width = "7%";
        doc_prepaying_sum_class = "md_size md_head_size md_footer_size cell-light-grey head-light-grey text-center";
        doc_expired_currency_sum_width = "7%";
        doc_expired_currency_sum_class = "md_size md_head_size md_footer_size text-center";
        doc_expired_sum_width = "7%";
        doc_expired_sum_class = "md_size md_head_size md_footer_size text-center";
        doc_trouble_currency_sum_width = "7%";
        doc_trouble_currency_sum_class = "md_size md_head_size md_footer_size cell-light-grey head-light-grey text-center";
        doc_troubl_sum_width = "7%";
        doc_troubl_sum_class = "md_size md_head_size md_footer_size cell-light-grey head-light-grey text-center";
        doc_all_currency_sum_width = "7%";
        doc_all_currency_sum_class = "md_size md_head_size md_footer_size text-center";
        doc_all_sum_width = "7%";
        doc_all_sum_class = "md_size md_head_size md_footer_size text-center";
        comment_id_width = "3%";
        comment_id_class = "md_size md_head_size md_footer_size text-center";
    }

    var vReportDKDocValue;
    vReportDKDocValue = {
        table : '#table-report-dk-doc',
        button_form: "#table-report-dk-doc-buttons",
        ajax : {
            "url": /*[[@{/report_dk/get_doc_table}]]*/ "report_dk/get_doc_table",
            "type": "post",
            "data": function ( d ) {
                d.dk_paid_type_id = vReportDKDocValue.rowdata.dk_paid_type_id;
                d.dkm_id = vReportDKDocValue.rowdata.dkm_id;
                d.dkmd_id = vReportDKDocValue.rowdata.dkmd_id;
                d.dk_ser_id = vReportDKDocValue.rowdata.dk_ser_id;
            }
        },
        key : "dkmdd_id",
        switchControl : report_dk_detail_switchControl,
        rowdata:{
            dkmdd_id: null,
            dk_paid_type_id: null,
            dkm_id: null,
            dkmd_id: null,
            dk_ser_id: null,
            order_name: null
        },
        ordering: true,
        order: [
            [12, "desc"]
        ],

        dom: vDomParam,
        createdRow: function(row, data, index) {
            $(row).css('background-color', '#ffffff');

            if ( data.prepaying_currency_sum !== '' ){ $(row).find('td:eq(7)').css('color', '#ff1d00');}
            if ( data.prepaying_sum !== '' ){ $(row).find('td:eq(8)').css('color', '#ff1d00');}

            if ( data.trouble_currency_sum > 0 ){ $(row).find('td:eq(11)').css('background-color', '#ff8566');}
            if ( data.troubl_sum > 0 ){ $(row).find('td:eq(12)').css('background-color', '#ff8566');}
        },
        columnDefs: [
            { "targets": [4], type: 'de_date'},
            { "targets": [5], type: 'de_date'},
            { "targets": [7,8,9,10,11,12,13,14],  render: $.fn.dataTable.render.number( '\ ', '.', 2, '' )},
            { "targets": [15],
                render: function ( data, type, row ) {
                    if ( type === 'display' ) {             //if column data is 1 then set attr to checked, use row id as input id (plus prefix)
                        return '<label class="custom-control custom-checkbox mb-0 mt-0 text-center"><input type="checkbox" ' + ((data == 1) ? 'checked' : '') + ' id="input' + row.id + '" class="custom-control-input" disabled><span class="custom-control-label"></span></label>'
                    }
                    return data;
                }
            },
        ],
        columns : [
            /*0*/{"title": /*[[#{report_dk.doc.dkmdd_id}]]*/ "dkmdd_id", "data": "dkmdd_id", "width": dkmdd_id_width, "className": dkmdd_id_class},
            /*1*/{"title": /*[[#{report_dk.doc.order_name}]]*/ "order_name", "data": "order_name", "width": order_name_width, "className": order_name_class},
            /*2*/{"title": /*[[#{report_dk.main.currency_id}]]*/ "currency_id", "data": "currency_id", "width": currency_id_width, "className": currency_id_class},
            /*3*/{"title": /*[[#{report_dk.main.currency_name}]]*/ "currency_name", "data": "currency_name", "width": currency_name_width, "className": currency_name_class},
            /*4*/{"title": /*[[#{report_dk.doc.bill_date}]]*/ "bill_date", "data": "bill_date", "width": bill_date_width, "className": bill_date_class},
            /*5*/{"title": /*[[#{report_dk.doc.paid_date}]]*/ "paid_date", "data": "paid_date", "width": paid_date_width, "className":paid_date_class},
            /*6*/{"title": /*[[#{report_dk.doc.day_count}]]*/ "day_count", "data": "day_count", "width": day_count_width, "className":day_count_class},
            /*7*/{"title": /*[[#{report_dk.main.prepaying_currency_sum}]]*/ "prepaying_currency_sum", "data": "prepaying_currency_sum", "width": doc_prepaying_currency_sum_width, "className": doc_prepaying_currency_sum_class},
            /*8*/{"title": /*[[#{report_dk.main.prepaying_sum}]]*/ "prepaying_sum", "data": "prepaying_sum", "width": doc_prepaying_sum_width, "className": doc_prepaying_sum_class},
            /*9*/{"title": /*[[#{report_dk.main.expired_currency_sum}]]*/ "expired_currency_sum", "data": "expired_currency_sum", "width": doc_expired_currency_sum_width, "className": doc_expired_currency_sum_class},
            /*10*/{"title": /*[[#{report_dk.main.expired_sum}]]*/ "expired_sum", "data": "expired_sum", "width": doc_expired_sum_width, "className": doc_expired_sum_class},
            /*11*/{"title": /*[[#{report_dk.main.trouble_currency_sum}]]*/ "trouble_currency_sum", "data": "trouble_currency_sum", "width": doc_trouble_currency_sum_width, "className": doc_trouble_currency_sum_class},
            /*12*/{"title": /*[[#{report_dk.main.troubl_sum}]]*/ "troubl_sum", "data": "troubl_sum", "width": doc_troubl_sum_width, "className": doc_troubl_sum_class},
            /*13*/{"title": /*[[#{report_dk.main.all_currency_sum}]]*/ "all_currency_sum", "data": "all_currency_sum", "width": doc_all_currency_sum_width, "className": doc_all_currency_sum_class},
            /*14*/{"title": /*[[#{report_dk.main.all_sum}]]*/ "all_sum", "data": "all_sum", "width": doc_all_sum_width, "className": doc_all_sum_class},
            /*15*/{"title": /*[[#{report_dk.main.dk_com_text_menu}]]*/ "comment_id", "data": "comment_id", "width": comment_id_width, "className": comment_id_class}
        ],
        pageLength: 25,
        copy_button: true,
        excel_button: true,
        pdf_button: true,
        print_button: true
    };

    function report_dk_detail_switchControl(){
        if(vReportDKDocValue.rowdata.dkmdd_id != null){
            $('#table-report-dk-doc-comment').prop('disabled', false).removeClass('btn-dark').addClass('btn-info');
        } else{
            $('#table-report-dk-doc-comment').prop('disabled', true).addClass('btn-dark').removeClass('btn-info');
        }
    }

    $('.positions_btn_control').on('click', function (){
        $("#positions-detail input[name=mode]").val($(this).attr("mode"));
    });

    function addDocComment(){
        fill_report_dk_doc_comment_modal_detail(0);
    }

    $('#table-report-dk-doc-comment').click(function () {
        addDocComment();
    });

    $(vReportDKDocValue.table).on('dblclick', '.doc_comment_add', function (e) {
        var selectedDocMainRow = this._DT_CellIndex.row;
        var currentDocMainTable = $(selectedDocMainRow.table).DataTable();
        var NameString =  /*[[${#authentication.name}]]*/ '';
        vReportDKDocValue.rowdata.dkm_id = vReportDKMainValue.rowdata.dkm_id;
        vReportDKDocValue.rowdata.dkmd_id = vReportDKContactValue.rowdata.dkmd_id;
        vReportDKDocValue.rowdata.cnt_id = vReportDKMainValue.rowdata.cnt_id;
        vReportDKDocValue.rowdata.cnt_name = vReportDKMainValue.rowdata.cnt_name;
        vReportDKDocValue.rowdata.contract = vReportDKContactValue.rowdata.contract;
        vReportDKDocValue.rowdata.dkmdd_id = currentMainTable.row(selectedMainRow).data().dkmdd_id;
        vReportDKDocValue.rowdata.order_name = currentMainTable.row(selectedMainRow).data().order_name;

        addDocComment();
    });

    $(document).ready(function(){
        recreateDataTable(vReportDKDocValue);
    });
</script>

</body>
</html>