<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.thymeleaf.org ">
<body>
<span th:fragment="wms_kpi_project_department_calculation_second_body" th:remove="tag">
    <div id="table-wms-kpi-project-department-calculation-second-buttons">
        <button type="button" id="wms-kpi-project-department-calculation-first-reloadbtn" class="btn btn-primary mr-2" data-toggle="tooltip" data-placement="bottom" th:title="#{general.refreshbtn}"><i class="fa fa-sync"></i></button>
    </div>
    <div><table id="table-wms-kpi-project-department-calculation-second" class="table table-striped table-sm table-bordered" cellspacing="0" style="width:100%;"></table></div>
</span>

<script th:fragment="cardscript" th:inline="javascript">
    var wms_kpi_result_id_show, wms_dep_id_show, wms_project_id_show, user_id_show, wms_kpi_year_id_show,
        wms_kpi_month_id_show, wms_kpi_param_id_show, wms_kpi_param_name_show, wms_kpi_plan_show,
        wms_kpi_fact_show, wms_kpi_malus_show, wms_kpi_finance_show, wms_kpi_view_type_id_show,
        wms_kpi_plan_unit_show, wms_kpi_fact_unit_show, wms_kpi_percent_show;

    var wms_kpi_result_id_width, wms_dep_id_width, wms_project_id_width, user_id_width, wms_kpi_year_id_width,
        wms_kpi_month_id_width, wms_kpi_param_id_width, wms_kpi_param_name_width, wms_kpi_plan_width,
        wms_kpi_fact_width, wms_kpi_malus_width, wms_kpi_finance_width, wms_kpi_view_type_id_width,
        wms_kpi_plan_unit_width, wms_kpi_fact_unit_width, wms_kpi_percent_width;

    var wms_kpi_result_id_class, wms_dep_id_class, wms_project_id_class, user_id_class, wms_kpi_year_id_class,
        wms_kpi_month_id_class, wms_kpi_param_id_class, wms_kpi_param_name_class, wms_kpi_plan_class,
        wms_kpi_fact_class, wms_kpi_malus_class, wms_kpi_finance_class, wms_kpi_view_type_id_class,
        wms_kpi_plan_unit_class, wms_kpi_fact_unit_class, wms_kpi_percent_class;

    if(mobileScreenSize){
        vDomParam = "Bfrtp";
    }
    else if(smallScreenSize){
        vDomParam = "Bfrtip";
        wms_kpi_result_id_show = false;
        wms_kpi_result_id_width = "";
        wms_kpi_result_id_class = "";
        wms_dep_id_show = false;
        wms_dep_id_width = "";
        wms_dep_id_class = "";
        wms_project_id_show = false;
        wms_project_id_width = "";
        wms_project_id_class = "";
        user_id_show = false;
        user_id_width = "";
        user_id_class = "";
        wms_kpi_year_id_show = false;
        wms_kpi_year_id_width = "";
        wms_kpi_year_id_class = "";
        wms_kpi_month_id_show = false;
        wms_kpi_month_id_width = "";
        wms_kpi_month_id_class = "";
        wms_kpi_param_id_show = true;
        wms_kpi_param_id_width = "5%";
        wms_kpi_param_id_class = "small_size small_footer_size head-center head-light-grey head-text-primary";
        wms_kpi_param_name_show = true;
        wms_kpi_param_name_width = "35%";
        wms_kpi_param_name_class = "small_size small_footer_size head-center head-light-grey head-text-primary";
        wms_kpi_plan_show = true;
        wms_kpi_plan_width = "10%";
        wms_kpi_plan_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_fact_show = true;
        wms_kpi_fact_width = "10%";
        wms_kpi_fact_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_malus_show = false;
        wms_kpi_malus_width = "";
        wms_kpi_malus_class = "";
        wms_kpi_finance_show = true;
        wms_kpi_finance_width = "10%";
        wms_kpi_finance_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_view_type_id_show = false;
        wms_kpi_view_type_id_width = "";
        wms_kpi_view_type_id_class = "";
        wms_kpi_plan_unit_show = true;
        wms_kpi_plan_unit_width = "10%";
        wms_kpi_plan_unit_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_fact_unit_show = true;
        wms_kpi_fact_unit_width = "10%";
        wms_kpi_fact_unit_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_percent_show = true;
        wms_kpi_percent_width = "10%";
        wms_kpi_percent_class = "small_size head-center head-light-grey head-text-primary";
    }
    else{
        vDomParam = "Bfrtip";
        wms_kpi_result_id_show = false;
        wms_kpi_result_id_width = "";
        wms_kpi_result_id_class = "";
        wms_dep_id_show = false;
        wms_dep_id_width = "";
        wms_dep_id_class = "";
        wms_project_id_show = false;
        wms_project_id_width = "";
        wms_project_id_class = "";
        user_id_show = false;
        user_id_width = "";
        user_id_class = "";
        wms_kpi_year_id_show = false;
        wms_kpi_year_id_width = "";
        wms_kpi_year_id_class = "";
        wms_kpi_month_id_show = false;
        wms_kpi_month_id_width = "";
        wms_kpi_month_id_class = "";
        wms_kpi_param_id_show = true;
        wms_kpi_param_id_width = "5%";
        wms_kpi_param_id_class = "small_size small_footer_size head-center head-light-grey head-text-primary";
        wms_kpi_param_name_show = true;
        wms_kpi_param_name_width = "35%";
        wms_kpi_param_name_class = "small_size small_footer_size head-center head-light-grey head-text-primary";
        wms_kpi_plan_show = true;
        wms_kpi_plan_width = "10%";
        wms_kpi_plan_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_fact_show = true;
        wms_kpi_fact_width = "10%";
        wms_kpi_fact_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_malus_show = false;
        wms_kpi_malus_width = "";
        wms_kpi_malus_class = "";
        wms_kpi_finance_show = true;
        wms_kpi_finance_width = "10%";
        wms_kpi_finance_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_view_type_id_show = false;
        wms_kpi_view_type_id_width = "";
        wms_kpi_view_type_id_class = "";
        wms_kpi_plan_unit_show = true;
        wms_kpi_plan_unit_width = "10%";
        wms_kpi_plan_unit_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_fact_unit_show = true;
        wms_kpi_fact_unit_width = "10%";
        wms_kpi_fact_unit_class = "small_size head-center head-light-grey head-text-primary";
        wms_kpi_percent_show = true;
        wms_kpi_percent_width = "10%";
        wms_kpi_percent_class = "small_size head-center head-light-grey head-text-primary";
    }

    var vWMSKPIProjectDepartmentCalcSecondValue;
    vWMSKPIProjectDepartmentCalcSecondValue = {
        table : '#table-wms-kpi-project-department-calculation-second',
        button_form: (mobileScreenSize) ? null : "#table-wms-kpi-project-department-calculation-second-buttons",
        ajax : {
            "url": /*[[@{/wms_kpi_project/get_wms_kpi_project_department_calculation_second_menu}]]*/ "wms_kpi_project/get_wms_kpi_project_department_calculation_second_menu",
            "type": "post",
            "data": function ( d ) {
                d.kpi_year = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.kpi_year;
                d.req_wms_dep_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_wms_dep_id;
                d.req_wms_project_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_wms_project_id;
                d.req_user_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_user_id;
                d.req_month_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_month_id;
            }
        },
        key : "wms_kpi_result_id",
        switchControl : wms_kpi_project_department_calculation_second_switchControl,
        rowdata:{
            wms_kpi_result_id: null,

            kpi_year: null,
            req_wms_dep_id: null,
            req_wms_project_id: null,
            req_user_id: null,
            req_month_id: null,

            wms_kpi_param_id: null,
            wms_kpi_view_type_id: null
        },
        ordering: true,
        order: [
            [6, "asc"]
        ],
        dom: vDomParam,
        createdRow: function( row, data, dataIndex ) {
        },
        columnDefs:[
            {"targets": [0], "width": wms_kpi_result_id_width, "className": wms_kpi_result_id_class, "visible": wms_kpi_result_id_show},
            {"targets": [1], "width": wms_dep_id_width, "className": wms_dep_id_class, "visible": wms_dep_id_show},
            {"targets": [2], "width": wms_project_id_width, "className": wms_project_id_class, "visible": wms_project_id_show},
            {"targets": [3], "width": user_id_width, "className": user_id_class, "visible": user_id_show},
            {"targets": [4], "width": wms_kpi_year_id_width, "className": wms_kpi_year_id_class, "visible": wms_kpi_year_id_show},
            {"targets": [5], "width": wms_kpi_month_id_width, "className": wms_kpi_month_id_class, "visible": wms_kpi_month_id_show},
            {"targets": [6], "width": wms_kpi_param_id_width, "className": wms_kpi_param_id_class, "visible": wms_kpi_param_id_show},
            {"targets": [7], "width": wms_kpi_param_name_width, "className": wms_kpi_param_name_class, "visible": wms_kpi_param_name_show},
            {"targets": [8], "width": wms_kpi_plan_width, "className": wms_kpi_plan_class, "visible": wms_kpi_plan_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [9], "width": wms_kpi_fact_width, "className": wms_kpi_fact_class, "visible": wms_kpi_fact_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [10], "width": wms_kpi_malus_width, "className": wms_kpi_malus_class, "visible": wms_kpi_malus_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [11], "width": wms_kpi_plan_unit_width, "className": wms_kpi_plan_unit_class, "visible": wms_kpi_plan_unit_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [12], "width": wms_kpi_fact_unit_width, "className": wms_kpi_fact_unit_class, "visible": wms_kpi_fact_unit_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [13], "width": wms_kpi_percent_width, "className": wms_kpi_percent_class, "visible": wms_kpi_percent_show, render: $.fn.dataTable.render.number( '\ ', '.', 2, '' )},
            {"targets": [14], "width": wms_kpi_finance_width, "className": wms_kpi_finance_class, "visible": wms_kpi_finance_show, render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [15], "width": wms_kpi_view_type_id_width, "className": wms_kpi_view_type_id_class, "visible": wms_kpi_view_type_id_show}
            ],
        columns : [
            /*0*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_result_id}]]*/ "wms_kpi_result_id","data": "wms_kpi_result_id"},
            /*1*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_dep_id}]]*/ "wms_dep_id","data": "wms_dep_id"},
            /*2*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_project_id}]]*/ "wms_project_id","data": "wms_project_id"},
            /*3*/{"title": /*[[#{wms_kpi_project.calculation_second.user_id}]]*/ "user_id","data": "user_id"},
            /*4*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_year_id}]]*/ "wms_kpi_year_id","data": "wms_kpi_year_id"},
            /*5*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_month_id}]]*/ "wms_kpi_month_id","data": "wms_kpi_month_id"},
            /*6*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_param_id}]]*/ "wms_kpi_param_id","data": "wms_kpi_param_id"},
            /*7*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_param_name}]]*/ "wms_kpi_param_name","data": "wms_kpi_param_name"},
            /*8*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_plan}]]*/ "wms_kpi_plan","data": "wms_kpi_plan"},
            /*9*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_fact}]]*/ "wms_kpi_fact","data": "wms_kpi_fact"},
            /*10*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_malus}]]*/ "wms_kpi_malus","data": "wms_kpi_malus"},
            /*11*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_plan_unit}]]*/ "wms_kpi_plan_unit","data": "wms_kpi_plan_unit"},
            /*12*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_fact_unit}]]*/ "wms_kpi_fact_unit","data": "wms_kpi_fact_unit"},
            /*13*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_percent}]]*/ "wms_kpi_percent","data": "wms_kpi_percent"},
            /*14*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_finance}]]*/ "wms_kpi_finance","data": "wms_kpi_finance"},
            /*15*/{"title": /*[[#{wms_kpi_project.calculation_second.wms_kpi_view_type_id}]]*/ "wms_kpi_finance","data": "wms_kpi_view_type_id"}
        ],
        pageLength: 25,
        copy_button: true,
        excel_button: true,
        pdf_button: true,
        print_button: true
    };

    function wms_kpi_project_department_calculation_second_change(){
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.kpi_year = $('#wms_kpi_project_year').val();
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_wms_dep_id = vWMSKPIProjectDepartmentValue.rowdata.wms_dep_id;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_wms_project_id = vWMSKPIProjectDepartmentProjectValue.rowdata.wms_project_id;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_user_id = vWMSKPIProjectDepartmentUserValue.rowdata.user_id;

        let MonthID = $("#wms_kpi_project_department_calculation_month").val();

        if( MonthID !== '' && MonthID !== null) {
            vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_month_id = MonthID;
        }
        else{
            let currentMonthDate = new Date();
            let currentMonth = currentMonthDate.getMonth()+1;
            $("#wms_kpi_project_department_calculation_month").val(currentMonth);
            vWMSKPIProjectDepartmentCalcSecondValue.rowdata.req_month_id = currentMonth;
        }
        let currentTabName = $("#wms_kpi_project_department_calculation_month").val();
        $('.nav-pills a[data-current-month="' + currentTabName + '"]').tab('show');

        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_result_id = null;
        wms_kpi_project_department_calculation_second_hide();

        $(vWMSKPIProjectDepartmentCalcSecondValue.table).DataTable().ajax.reload(null, false);
    }
    
    function wms_kpi_project_department_calculation_second_hide() {
        $('#wms_kpi_project_department_days_row').attr('hidden',true);
        $('#wms_kpi_project_department_days_finance_row').attr('hidden',true);
        $('#wms_kpi_project_department_days_text_row').attr('hidden',true);
    }

    function wms_kpi_project_department_calculation_second_switchControl(){
        wms_kpi_project_department_calculation_second_hide();
        if(vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_result_id != null) {
            if (vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_view_type_id === 1) {
                $('#wms_kpi_project_department_days_row').removeAttr('hidden');
                vWMSKPIProjectDepartmentDaysValue.rowdata.kpi_year = $('#wms_kpi_project_year').val();
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_dep_id = vWMSKPIProjectDepartmentValue.rowdata.wms_dep_id;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_project_id = vWMSKPIProjectDepartmentProjectValue.rowdata.wms_project_id;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_user_id = vWMSKPIProjectDepartmentUserValue.rowdata.user_id;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_month_id = $("#wms_kpi_project_department_calculation_month").val();
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_kpi_param_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_param_id;
                vWMSKPIProjectDepartmentDaysValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysValue.table).DataTable().ajax.reload(null, false);
            }
            else if (vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_view_type_id === 2) {
                $('#wms_kpi_project_department_days_finance_row').removeAttr('hidden');
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.kpi_year = $('#wms_kpi_project_year').val();
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_dep_id = vWMSKPIProjectDepartmentValue.rowdata.wms_dep_id;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_project_id = vWMSKPIProjectDepartmentProjectValue.rowdata.wms_project_id;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_user_id = vWMSKPIProjectDepartmentUserValue.rowdata.user_id;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_month_id = $("#wms_kpi_project_department_calculation_month").val();
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_kpi_param_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_param_id;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysFinanceValue.table).DataTable().ajax.reload(null, false);
            }
            else if (vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_view_type_id === 3) {
                $('#wms_kpi_project_department_days_text_row').removeAttr('hidden');
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.kpi_year = $('#wms_kpi_project_year').val();
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_dep_id = vWMSKPIProjectDepartmentValue.rowdata.wms_dep_id;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_project_id = vWMSKPIProjectDepartmentProjectValue.rowdata.wms_project_id;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_user_id = vWMSKPIProjectDepartmentUserValue.rowdata.user_id;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_month_id = $("#wms_kpi_project_department_calculation_month").val();
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_kpi_param_id = vWMSKPIProjectDepartmentCalcSecondValue.rowdata.wms_kpi_param_id;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysTextValue.table).DataTable().ajax.reload(null, false);
            }
            else {
                vWMSKPIProjectDepartmentDaysValue.rowdata.kpi_year = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_dep_id = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_project_id = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_user_id = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_month_id = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.req_wms_kpi_param_id = null;
                vWMSKPIProjectDepartmentDaysValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysValue.table).DataTable().ajax.reload(null, false);

                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.kpi_year = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_dep_id = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_project_id = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_user_id = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_month_id = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.req_wms_kpi_param_id = null;
                vWMSKPIProjectDepartmentDaysFinanceValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysFinanceValue.table).DataTable().ajax.reload(null, false);

                vWMSKPIProjectDepartmentDaysTextValue.rowdata.kpi_year = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_dep_id = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_project_id = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_user_id = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_month_id = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.req_wms_kpi_param_id = null;
                vWMSKPIProjectDepartmentDaysTextValue.rowdata.row_id = null;

                $(vWMSKPIProjectDepartmentDaysTextValue.table).DataTable().ajax.reload(null, false);
            }
        }
    }

    $(document).ready(function(){
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.dep_kpi_user_id = /*[[${dep_kpi_user_id}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.kpi_facts_year = /*[[${kpi_facts_year}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.kpi_facts_month = /*[[${kpi_facts_month}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.dep_id = /*[[${dep_id}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.user_kpi_type_id = /*[[${user_kpi_type_id}]]*/ null;

        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.table_order_column = /*[[${table_order_column}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.table_order_type = /*[[${table_order_type}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.table_search = /*[[${table_search}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.table_pagelen = /*[[${table_pagelen}]]*/ null;
        vWMSKPIProjectDepartmentCalcSecondValue.rowdata.table_page = /*[[${table_page}]]*/ null;

        recreateDataTable(vWMSKPIProjectDepartmentCalcSecondValue);
    });
</script>

</body>
</html>