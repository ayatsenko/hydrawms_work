<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.thymeleaf.org ">
<body>
<span th:fragment="kpi_facts_calculation_body" th:remove="tag">
    <div id="table-kpi-facts-calculation-buttons">
    </div>
    <div><table id="table-kpi-facts-calculation" class="table table-striped table-sm table-bordered" cellspacing="0" style="width:100%;"></table></div>
</span>

<script th:fragment="cardscript" th:inline="javascript">
    var rn_id_show, kpirupl_id_show, user_kpi_type_id_show, user_kpi_type_name_show, user_kpi_type_plan_id_show, user_kpi_type_malus_id_show, user_kpi_type_bonus_id_show,
        user_kpi_type_general_id_show, kpirupl_plan_show, kpirupl_fact_show, kpirupl_persent_show, kpirupl_malus_show, kpirupl_finance_show, kpirupl_colour_show;

    var rn_id_width, kpirupl_id_width, user_kpi_type_id_width, user_kpi_type_name_width, user_kpi_type_plan_id_width, user_kpi_type_malus_id_width,
        user_kpi_type_bonus_id_width, user_kpi_type_general_id_width, kpirupl_plan_width, kpirupl_fact_width, kpirupl_persent_width, kpirupl_malus_width,
        kpirupl_finance_width, kpirupl_colour_width;

    var rn_id_class, kpirupl_id_class, user_kpi_type_id_class, user_kpi_type_name_class, user_kpi_type_plan_id_class, user_kpi_type_malus_id_class,
        user_kpi_type_bonus_id_class, user_kpi_type_general_id_class, kpirupl_plan_class, kpirupl_plan_class_edit, kpirupl_fact_class, kpirupl_persent_class, kpirupl_malus_class,
        kpirupl_finance_class, kpirupl_colour_class;

    if(mobileScreenSize){
        vDomParam = "Bfrtp";
    }
    else if(smallScreenSize){
        vDomParam = "Bfrtip";
        rn_id_show = false;
        rn_id_width = "";
        rn_id_class = "";
        kpirupl_id_show = false;
        kpirupl_id_width = "";
        kpirupl_id_class = "";
        user_kpi_type_id_show = false;
        user_kpi_type_id_width = "";
        user_kpi_type_id_class = "";
        user_kpi_type_name_show = true;
        user_kpi_type_name_width = "40%";
        user_kpi_type_name_class = "small_size small_head_size small_footer_size";
        user_kpi_type_plan_id_show = false;
        user_kpi_type_plan_id_width = "";
        user_kpi_type_plan_id_class = "";
        user_kpi_type_malus_id_show = false;
        user_kpi_type_malus_id_width = "";
        user_kpi_type_malus_id_class = "";
        user_kpi_type_bonus_id_show = false;
        user_kpi_type_bonus_id_width = "";
        user_kpi_type_bonus_id_class = "";
        user_kpi_type_general_id_show = false;
        user_kpi_type_general_id_width = "";
        user_kpi_type_general_id_class = "";
        kpirupl_plan_show = true;
        kpirupl_plan_width = "15%";
        kpirupl_plan_class = "small_size small_head_size small_footer_size text-center plan_edit head-link";
        kpirupl_fact_show = true;
        kpirupl_fact_width = "15%";
        kpirupl_fact_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_persent_show = true;
        kpirupl_persent_width = "10%";
        kpirupl_persent_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_malus_show = true;
        kpirupl_malus_width = "10%";
        kpirupl_malus_class = "small_size small_head_size small_footer_size text-center malus_edit head-link";
        kpirupl_finance_show = true;
        kpirupl_finance_width = "10%";
        kpirupl_finance_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_colour_show = false;
        kpirupl_colour_width = "";
        kpirupl_colour_class = "";
    }
    else{
        vDomParam = "Bfrtip";
        rn_id_show = false;
        rn_id_width = "";
        rn_id_class = "";
        kpirupl_id_show = false;
        kpirupl_id_width = "";
        kpirupl_id_class = "";
        user_kpi_type_id_show = false;
        user_kpi_type_id_width = "";
        user_kpi_type_id_class = "";
        user_kpi_type_name_show = true;
        user_kpi_type_name_width = "40%";
        user_kpi_type_name_class = "small_size small_head_size small_footer_size";
        user_kpi_type_plan_id_show = false;
        user_kpi_type_plan_id_width = "";
        user_kpi_type_plan_id_class = "";
        user_kpi_type_malus_id_show = false;
        user_kpi_type_malus_id_width = "";
        user_kpi_type_malus_id_class = "";
        user_kpi_type_bonus_id_show = false;
        user_kpi_type_bonus_id_width = "";
        user_kpi_type_bonus_id_class = "";
        user_kpi_type_general_id_show = false;
        user_kpi_type_general_id_width = "";
        user_kpi_type_general_id_class = "";
        kpirupl_plan_show = true;
        kpirupl_plan_width = "15%";
        kpirupl_plan_class = "small_size small_head_size small_footer_size text-center plan_edit head-link";
        kpirupl_fact_show = true;
        kpirupl_fact_width = "15%";
        kpirupl_fact_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_persent_show = true;
        kpirupl_persent_width = "10%";
        kpirupl_persent_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_malus_show = true;
        kpirupl_malus_width = "10%";
        kpirupl_malus_class = "small_size small_head_size small_footer_size text-center malus_edit head-link";
        kpirupl_finance_show = true;
        kpirupl_finance_width = "10%";
        kpirupl_finance_class = "small_size small_head_size small_footer_size text-center";
        kpirupl_colour_show = false;
        kpirupl_colour_width = "";
        kpirupl_colour_class = "";
    }

    var vKPIFactCalcValue;
    vKPIFactCalcValue = {
        table : '#table-kpi-facts-calculation',
        button_form: (mobileScreenSize) ? null : "#table-kpi-facts-calculation-buttons",
        ajax : {
            "url": /*[[@{/kpi_facts/get_calc_table}]]*/ "kpi_facts/get_calc_table",
            "type": "post",
            "data": function ( d ) {
                d.kpi_user_id = vKPIFactCalcValue.rowdata.kpi_user_id;
                d.kpi_facts_year = vKPIFactCalcValue.rowdata.kpi_facts_year;
                d.kpi_facts_month = vKPIFactCalcValue.rowdata.kpi_facts_month;
                d.dep_id = vKPIFactCalcValue.rowdata.dep_id;
            }
        },
        key : "user_kpi_type_id",
        switchControl : kpi_facts_calc_switchControl,
        rowdata:{
            user_kpi_type_id: null,
            user_kpi_type_name: null,
            kpi_user_id: null,
            kpi_facts_year: null,
            kpi_facts_month: null,
            dep_id: null,

            kpirupl_id: null,
            user_kpi_type_plan_id: null,
            user_kpi_type_malus_id: null,
            user_kpi_type_bonus_id: null,
            user_kpi_type_general_id: null,
            kpirupl_plan: null,
            kpirupl_malus: null,
            kpirupl_finance: null
        },
        ordering: true,
        order: [
            [0, "asc"]
        ],

        dom: vDomParam,
        createdRow: function( row, data, dataIndex ) {
            $(row).find('td:eq(2)').css('background-color', data["kpirupl_colour"]);
            $(row).find('td:eq(3)').css('background-color', data["kpirupl_colour"]);
            $(row).find('td:eq(4)').css('background-color', data["kpirupl_colour"]);
            $(row).find('td:eq(5)').css('background-color', data["kpirupl_colour"]);
            if(data.user_kpi_type_plan_id === 1){
                $(row).find('td:eq(1)').addClass('th-link');
            }
            else{
                $(row).find('td:eq(1)').removeClass('th-link');
            }
            if(data.user_kpi_type_malus_id === 1){
                $(row).find('td:eq(4)').addClass('th-link');
            }
            else{
                $(row).find('td:eq(4)').removeClass('th-link');
            }
        },
        columnDefs:[
            {"targets": [0], "width": rn_id_width, "className": rn_id_class, "visible": rn_id_show},
            {"targets": [1], "width": kpirupl_id_width, "className": kpirupl_id_class, "visible": kpirupl_id_show},
            {"targets": [2], "width": user_kpi_type_id_width, "className": user_kpi_type_id_class, "visible": user_kpi_type_id_show},
            {"targets": [3], "width": user_kpi_type_name_width, "className": user_kpi_type_name_class, "visible": user_kpi_type_name_show},
            {"targets": [4], "width": user_kpi_type_plan_id_width,  "className": user_kpi_type_plan_id_class, "visible": user_kpi_type_plan_id_show},
            {"targets": [5], "width": user_kpi_type_malus_id_width, "className": user_kpi_type_malus_id_class, "visible": user_kpi_type_malus_id_show},
            {"targets": [6], "width": user_kpi_type_bonus_id_width, "className": user_kpi_type_bonus_id_class, "visible": user_kpi_type_bonus_id_show},
            {"targets": [7], "width": user_kpi_type_general_id_width, "className": user_kpi_type_general_id_class, "visible": user_kpi_type_general_id_show},
            {"targets": [8], "width": kpirupl_plan_width, "className": kpirupl_plan_class, "visible": kpirupl_plan_show,  render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [9], "width": kpirupl_fact_width, "className": kpirupl_fact_class, "visible": kpirupl_fact_show,  render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [10], "width": kpirupl_persent_width, "className": kpirupl_persent_class, "visible": kpirupl_persent_show,  render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [11], "width": kpirupl_malus_width, "className": kpirupl_malus_class, "visible": kpirupl_malus_show,  render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [12], "width": kpirupl_finance_width, "className": kpirupl_finance_class, "visible": kpirupl_finance_show,  render: $.fn.dataTable.render.number( '\ ', '.', 0, '' )},
            {"targets": [13], "width": kpirupl_colour_width, "className": kpirupl_colour_class, "visible": kpirupl_colour_show}
        ],
        columns : [
            /*0*/{"title": /*[[#{kpi_facts.calc.rn_id}]]*/ "rn_id","data": "rn_id"},
            /*1*/{"title": /*[[#{kpi_facts.calc.kpirupl_id}]]*/ "kpirupl_id","data": "kpirupl_id"},
            /*2*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_id}]]*/ "user_kpi_type_id","data": "user_kpi_type_id"},
            /*3*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_name}]]*/ "user_kpi_type_name","data": "user_kpi_type_name"},

            /*4*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_plan_id}]]*/ "user_kpi_type_plan_id","data": "user_kpi_type_plan_id"},
            /*5*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_malus_id}]]*/ "user_kpi_type_malus_id","data": "user_kpi_type_malus_id"},
            /*6*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_bonus_id}]]*/ "user_kpi_type_bonus_id","data": "user_kpi_type_bonus_id"},
            /*7*/{"title": /*[[#{kpi_facts.calc.user_kpi_type_general_id}]]*/ "user_kpi_type_general_id","data": "user_kpi_type_general_id"},
            /*8*/{"title": /*[[#{kpi_facts.calc.kpirupl_plan}]]*/ "kpirupl_plan","data": "kpirupl_plan"},
            /*9*/{"title": /*[[#{kpi_facts.calc.kpirupl_fact}]]*/ "kpirupl_fact","data": "kpirupl_fact"},
            /*10*/{"title": /*[[#{kpi_facts.calc.kpirupl_persent}]]*/ "kpirupl_persent","data": "kpirupl_persent"},
            /*11*/{"title": /*[[#{kpi_facts.calc.kpirupl_malus}]]*/ "kpirupl_malus","data": "kpirupl_malus"},
            /*12*/{"title": /*[[#{kpi_facts.calc.kpirupl_finance}]]*/ "kpirupl_finance","data": "kpirupl_finance"},
            /*13*/{"title": /*[[#{kpi_facts.calc.kpirupl_colour}]]*/ "kpirupl_colour","data": "kpirupl_colour"}
        ],
        pageLength: 50,
        copy_button: true,
        excel_button: true,
        pdf_button: true,
        print_button: true
    };

    function kpi_facts_calc_hide() {
//CS
        $('#kpi_facts_cs_meets').attr('hidden', true);
        $('#kpi_facts_cs_calls').attr('hidden', true);
        $('#kpi_facts_cs_requests').attr('hidden', true);
        $('#kpi_facts_cs_tenders').attr('hidden', true);

        $('#kpi_facts_cs_clients_finance').attr('hidden', true);
        kpi_facts_cs_clients_finance_hide();
        $('#kpi_facts_cs_clients_profit').attr('hidden', true);
        kpi_facts_cs_clients_profit_hide();
        $('#kpi_facts_cs_clients_unpaid').attr('hidden', true);
        kpi_facts_cs_clients_unpaid_hide();
        $('#kpi_facts_cs_clients_debtors_result').attr('hidden', true);
        kpi_facts_cs_clients_debtors_result_hide();
//CS CRM
        $('#kpi_facts_cs_crm').attr('hidden', true);
        kpi_facts_cs_crm_hide();
//OPS
        $('#kpi_facts_ops_clients_finance_old').attr('hidden', true);
        kpi_facts_ops_clients_finance_old_hide();
        $('#kpi_facts_ops_clients_finance_new').attr('hidden', true);
        kpi_facts_ops_clients_finance_new_hide();
        $('#kpi_facts_ops_clients_finance_all').attr('hidden', true);
        kpi_facts_ops_clients_finance_all_hide();
        $('#kpi_facts_ops_clients_finance_count').attr('hidden', true);
        kpi_facts_ops_clients_finance_count_hide();
//Div CRM
        $('#kpi_facts_div_crm_general').attr('hidden', true);
        kpi_facts_div_crm_general_hide();
    }

    function kpi_facts_calc_switchControl(){
        kpi_facts_calc_hide();
        if(vKPIFactCalcValue.rowdata.user_kpi_type_id != null) {
            /*CS Meets*/
            if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 1) {
                $('#kpi_facts_cs_meets').removeAttr('hidden');
                vKPICsMeetsValue.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPICsMeetsValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPICsMeetsValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPICsMeetsValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPICsMeetsValue.table).DataTable().ajax.reload(null, false);
            }
            /*CS Calls*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 2) {
                $('#kpi_facts_cs_calls').removeAttr('hidden');
                vKPICsCallsValue.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPICsCallsValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPICsCallsValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPICsCallsValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPICsCallsValue.table).DataTable().ajax.reload(null, false);
            }
            /*CS Requests*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 3) {
                $('#kpi_facts_cs_requests').removeAttr('hidden');
                vKPIFactsCsRequestsValue.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsRequestsValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsRequestsValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsRequestsValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsRequestsValue.table).DataTable().ajax.reload(null, false);
                $('#kpi_facts_cs_tenders').removeAttr('hidden');
                vKPIFactsCsTendersValue.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsTendersValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsTendersValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsTendersValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsTendersValue.table).DataTable().ajax.reload(null, false);
            }
            /*CS Client Finance*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 4) {
                $('#kpi_facts_cs_clients_finance').removeAttr('hidden');
                vKPIFactsCsClientsFinance.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsClientsFinance.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsClientsFinance.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsClientsFinance.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsClientsFinance.table).DataTable().ajax.reload(null, false);
            }
            /*CS CRM*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 5) {
                $('#kpi_facts_cs_crm').removeAttr('hidden');
                vKPIFactsCsCRMValue.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsCRMValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsCRMValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsCRMValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsCRMValue.table).DataTable().ajax.reload(null, false);
            }
            /*CS Client Profit*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 22) {
                $('#kpi_facts_cs_clients_profit').removeAttr('hidden');
                vKPIFactsCsClientsProfit.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsClientsProfit.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsClientsProfit.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsClientsProfit.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsClientsProfit.table).DataTable().ajax.reload(null, false);
            }
            /*CS Client Unpaid*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 23) {
                $('#kpi_facts_cs_clients_unpaid').removeAttr('hidden');
                vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsClientsUnpaid.table).DataTable().ajax.reload(null, false);
            }
            /*CS Client Debtors*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 21) {
                $('#kpi_facts_cs_clients_debtors_result').removeAttr('hidden');
                vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsCsClientsDebtorsResult.table).DataTable().ajax.reload(null, false);
            }
            /*OPS Finance OLD*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 18) {
                $('#kpi_facts_ops_clients_finance_old').removeAttr('hidden');
                vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsOpsClientsFinanceOld.table).DataTable().ajax.reload(null, false);
            }
            /*OPS Finance New*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 19) {
                $('#kpi_facts_ops_clients_finance_new').removeAttr('hidden');
                vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsOpsClientsFinanceNew.table).DataTable().ajax.reload(null, false);
            }
            /*OPS Finance All*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 28) {
                $('#kpi_facts_ops_clients_finance_all').removeAttr('hidden');
                vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsOpsClientsFinanceAll.table).DataTable().ajax.reload(null, false);
            }
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 29) {
                $('#kpi_facts_ops_clients_finance_count').removeAttr('hidden');
                vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsOpsClientsFinanceCount.table).DataTable().ajax.reload(null, false);
            }
            /*Div CRM*/
            else if (vKPIFactCalcValue.rowdata.user_kpi_type_id === 13) {
                $('#kpi_facts_div_crm_general').removeAttr('hidden');
                vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_crm_param_id = vKPIFactCalcValue.rowdata.user_kpi_type_id;
                vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_user_id = vKPIFactUsersValue.rowdata.user_id;
                vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_year = $("#kpi_facts_year").val();
                vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_month = $("#kpi_facts_month").val();
                $(vKPIFactsDivCRMGeneralValue.table).DataTable().ajax.reload(null, false);
            }
        }
        else{
            /*CS Meets*/
            vKPICsMeetsValue.rowdata.kpi_facts_param_id = null;
            vKPICsMeetsValue.rowdata.kpi_facts_user_id = null;
            vKPICsMeetsValue.rowdata.kpi_facts_year = null;
            vKPICsMeetsValue.rowdata.kpi_facts_month = null;
            vKPICsMeetsValue.rowdata.act_id = null;
            $(vKPICsMeetsValue.table).DataTable().clear().draw();
            /*CS Calls*/
            vKPICsCallsValue.rowdata.kpi_facts_param_id = null;
            vKPICsCallsValue.rowdata.kpi_facts_user_id = null;
            vKPICsCallsValue.rowdata.kpi_facts_year = null;
            vKPICsCallsValue.rowdata.kpi_facts_month = null;
            vKPICsCallsValue.rowdata.act_id = null;
            $(vKPICsCallsValue.table).DataTable().clear().draw();
            /*CS Requests*/
            vKPIFactsCsRequestsValue.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsRequestsValue.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsRequestsValue.rowdata.kpi_facts_year = null;
            vKPIFactsCsRequestsValue.rowdata.kpi_facts_month = null;
            vKPIFactsCsRequestsValue.rowdata.req_id = null;
            $(vKPIFactsCsRequestsValue.table).DataTable().clear().draw();
            /*CS Tenders*/
            vKPIFactsCsTendersValue.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsTendersValue.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsTendersValue.rowdata.kpi_facts_year = null;
            vKPIFactsCsTendersValue.rowdata.kpi_facts_month = null;
            vKPIFactsCsTendersValue.rowdata.req_id = null;
            $(vKPIFactsCsTendersValue.table).DataTable().clear().draw();
            /*Cs Client Finance*/
            vKPIFactsCsClientsFinance.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsClientsFinance.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsClientsFinance.rowdata.kpi_facts_year = null;
            vKPIFactsCsClientsFinance.rowdata.kpi_facts_month = null;
            vKPIFactsCsClientsFinance.rowdata.rn = null;
            $(vKPIFactsCsClientsFinance.table).DataTable().clear().draw();
            /*CS CRM*/
            vKPIFactsCsCRMValue.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsCRMValue.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsCRMValue.rowdata.kpi_facts_year = null;
            vKPIFactsCsCRMValue.rowdata.kpi_facts_month = null;
            vKPIFactsCsCRMValue.rowdata.user_kpi_crm_type_id = null;
            $(vKPIFactsCsCRMValue.table).DataTable().clear().draw();
            /*Cs Client Profit*/
            vKPIFactsCsClientsProfit.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsClientsProfit.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsClientsProfit.rowdata.kpi_facts_year = null;
            vKPIFactsCsClientsProfit.rowdata.kpi_facts_month = null;
            vKPIFactsCsClientsProfit.rowdata.rn = null;
            $(vKPIFactsCsClientsProfit.table).DataTable().clear().draw();
            /*Cs Client Unpaid*/
            vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_year = null;
            vKPIFactsCsClientsUnpaid.rowdata.kpi_facts_month = null;
            vKPIFactsCsClientsUnpaid.rowdata.rn = null;
            $(vKPIFactsCsClientsUnpaid.table).DataTable().clear().draw();
            /*Cs Client Debtors*/
            vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_param_id = null;
            vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_user_id = null;
            vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_year = null;
            vKPIFactsCsClientsDebtorsResult.rowdata.kpi_facts_month = null;
            vKPIFactsCsClientsDebtorsResult.rowdata.rn = null;
            $(vKPIFactsCsClientsDebtorsResult.table).DataTable().clear().draw();
            /*OPS Finance Old*/
            vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_param_id = null;
            vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_user_id = null;
            vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_year = null;
            vKPIFactsOpsClientsFinanceOld.rowdata.kpi_facts_month = null;
            vKPIFactsOpsClientsFinanceOld.rowdata.rn = null;
            $(vKPIFactsOpsClientsFinanceOld.table).DataTable().clear().draw();
            /*OPS Finance New*/
            vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_param_id = null;
            vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_user_id = null;
            vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_year = null;
            vKPIFactsOpsClientsFinanceNew.rowdata.kpi_facts_month = null;
            vKPIFactsOpsClientsFinanceNew.rowdata.rn = null;
            $(vKPIFactsOpsClientsFinanceNew.table).DataTable().clear().draw();
            /*OPS Finance All*/
            vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_param_id = null;
            vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_user_id = null;
            vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_year = null;
            vKPIFactsOpsClientsFinanceAll.rowdata.kpi_facts_month = null;
            vKPIFactsOpsClientsFinanceAll.rowdata.rn = null;
            $(vKPIFactsOpsClientsFinanceAll.table).DataTable().clear().draw();
            /*OPS Finance Count*/
            vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_param_id = null;
            vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_user_id = null;
            vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_year = null;
            vKPIFactsOpsClientsFinanceCount.rowdata.kpi_facts_month = null;
            vKPIFactsOpsClientsFinanceCount.rowdata.rn = null;
            $(vKPIFactsOpsClientsFinanceCount.table).DataTable().clear().draw();
            /*Div CRM*/
            vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_param_id = null;
            vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_user_id = null;
            vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_year = null;
            vKPIFactsDivCRMGeneralValue.rowdata.kpi_facts_month = null;
            vKPIFactsDivCRMGeneralValue.rowdata.user_kpi_crm_type_id = null;
            $(vKPIFactsDivCRMGeneralValue.table).DataTable().clear().draw();
        }
    }

    function editCalculationPlan(){
        $('#kpi_facts_plan_modal_addbtn').attr('hidden',true);
        $('#kpi_facts_plan_modal_editbtn').removeAttr('hidden');
        $('#kpi_facts_plan_modal_delbtn').attr('hidden',true);

        fill_kpi_facts_plan_modal_detail(1);
    }

    function editCalculationMalus(){
        $('#kpi_facts_malus_modal_addbtn').attr('hidden',true);
        $('#kpi_facts_malus_modal_editbtn').removeAttr('hidden');
        $('#kpi_facts_malus_modal_delbtn').attr('hidden',true);

        fill_kpi_facts_malus_modal_detail(1);
    }

    $(document).ready(function(){
        vKPIFactCalcValue.rowdata.dep_kpi_user_id = /*[[${dep_kpi_user_id}]]*/ null;
        vKPIFactCalcValue.rowdata.kpi_facts_year = /*[[${kpi_facts_year}]]*/ null;
        vKPIFactCalcValue.rowdata.kpi_facts_month = /*[[${kpi_facts_month}]]*/ null;
        vKPIFactCalcValue.rowdata.dep_id = /*[[${dep_id}]]*/ null;
        vKPIFactCalcValue.rowdata.user_kpi_type_id = /*[[${user_kpi_type_id}]]*/ null;

        vKPIFactCalcValue.rowdata.table_order_column = /*[[${table_order_column}]]*/ null;
        vKPIFactCalcValue.rowdata.table_order_type = /*[[${table_order_type}]]*/ null;
        vKPIFactCalcValue.rowdata.table_search = /*[[${table_search}]]*/ null;
        vKPIFactCalcValue.rowdata.table_pagelen = /*[[${table_pagelen}]]*/ null;
        vKPIFactCalcValue.rowdata.table_page = /*[[${table_page}]]*/ null;

        recreateDataTable(vKPIFactCalcValue);

        $(vKPIFactCalcValue.table).on('dblclick', '.plan_edit', function (e) {
            let selectedPlanRow = this._DT_CellIndex.row;
            let PlanTable = $(vKPIFactCalcValue.table).DataTable();
            vKPIFactCalcValue.rowdata.kpirupl_id = PlanTable.row(selectedPlanRow).data().kpirupl_id;
            vKPIFactCalcValue.rowdata.user_kpi_type_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_id;
            vKPIFactCalcValue.rowdata.user_kpi_type_name = PlanTable.row(selectedPlanRow).data().user_kpi_type_name;
            vKPIFactCalcValue.rowdata.user_kpi_type_plan_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_plan_id;
            vKPIFactCalcValue.rowdata.kpirupl_plan = PlanTable.row(selectedPlanRow).data().kpirupl_plan;
            vKPIFactCalcValue.rowdata.user_kpi_type_general_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_general_id;

            if (vKPIFactCalcValue.rowdata.user_kpi_type_plan_id === 1 && RoleAllAdmin) {
                editCalculationPlan();
            }
        });

        $(vKPIFactCalcValue.table).on('dblclick', '.malus_edit', function (e) {
            let selectedPlanRow = this._DT_CellIndex.row;
            let PlanTable = $(vKPIFactCalcValue.table).DataTable();
            vKPIFactCalcValue.rowdata.kpirupl_id = PlanTable.row(selectedPlanRow).data().kpirupl_id;
            vKPIFactCalcValue.rowdata.user_kpi_type_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_id;
            vKPIFactCalcValue.rowdata.user_kpi_type_name = PlanTable.row(selectedPlanRow).data().user_kpi_type_name;
            vKPIFactCalcValue.rowdata.user_kpi_type_malus_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_malus_id;
            vKPIFactCalcValue.rowdata.kpirupl_malus = PlanTable.row(selectedPlanRow).data().kpirupl_malus;
            vKPIFactCalcValue.rowdata.user_kpi_type_general_id = PlanTable.row(selectedPlanRow).data().user_kpi_type_general_id;

            if (vKPIFactCalcValue.rowdata.user_kpi_type_malus_id === 1 && RoleAllAdmin) {
                editCalculationMalus();
            }
        });
    });
</script>

</body>
</html>